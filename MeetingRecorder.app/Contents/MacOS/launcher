#!/bin/bash

# Meeting Recorder Launcher
# This script launches the Meeting Recorder menu bar app

LOG_FILE="/tmp/meeting-recorder-launcher.log"
exec > "$LOG_FILE" 2>&1
echo "$(date): Launcher starting..."

# Hardcoded project directory (most reliable)
PROJECT_DIR="/Volumes/external_storage/Personal/Projects/meetings-ai-notes"

# Fallback: try to find it relative to the app bundle
if [ ! -f "$PROJECT_DIR/run.py" ]; then
    APP_DIR="$(dirname "$(dirname "$(dirname "$0")")")"
    PROJECT_DIR="$(dirname "$APP_DIR")"
fi

# Final check
if [ ! -f "$PROJECT_DIR/run.py" ]; then
    echo "$(date): ERROR - Could not find run.py in $PROJECT_DIR"
    osascript -e 'display notification "Could not find Meeting Recorder project" with title "Error"'
    exit 1
fi

echo "$(date): Using PROJECT_DIR=$PROJECT_DIR"
cd "$PROJECT_DIR"

# Load HF token from .env file if it exists
if [ -f ".env" ]; then
    echo "$(date): Loading .env file"
    set -a
    source .env
    set +a
fi

# Set HF_TOKEN if not already set (fallback)
export HF_TOKEN="${HF_TOKEN:-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}"
echo "$(date): HF_TOKEN set (${#HF_TOKEN} chars)"

# Run the menu bar app with run.py (simpler, more reliable)
echo "$(date): Launching python3 run.py"
exec /usr/bin/python3 run.py
